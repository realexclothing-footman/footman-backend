<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FOOTMAN Business Admin - Updated</title>
    <style>
        /* ========== VARIABLES ========== */
        :root {
            --primary: #10b981;
            --primary-dark: #059669;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --light: #f8fafc;
            --dark: #1e293b;
            --sidebar: #1e293b;
            --card-bg: #ffffff;
            --border: #e2e8f0;
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        /* ========== RESET & BASE ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f1f5f9;
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* ========== LAYOUT ========== */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* ========== SIDEBAR ========== */
        .sidebar {
            width: 280px;
            background: var(--sidebar);
            color: white;
            padding: 24px 0;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            z-index: 100;
        }

        .sidebar-header {
            padding: 0 24px 32px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 24px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: var(--primary);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 24px;
        }

        .logo-text h2 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .logo-text span {
            font-size: 12px;
            opacity: 0.7;
        }

        .nav-section {
            margin-bottom: 24px;
        }

        .nav-section-title {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: rgba(255, 255, 255, 0.5);
            padding: 0 24px 12px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 24px;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: var(--transition);
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            position: relative;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: white;
            padding-left: 28px;
        }

        .nav-item.active {
            background: var(--primary);
            color: white;
            border-left: 4px solid white;
        }

        .nav-badge {
            margin-left: auto;
            font-size: 12px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 12px;
            min-width: 24px;
            text-align: center;
        }

        .badge-success { background: var(--success); color: white; }
        .badge-warning { background: var(--warning); color: white; }
        .badge-danger { background: var(--danger); color: white; }
        .badge-info { background: var(--info); color: white; }

        .sidebar-footer {
            margin-top: auto;
            padding: 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* ========== MAIN CONTENT ========== */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        .topbar {
            background: var(--card-bg);
            padding: 0 32px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 72px;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .topbar-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 20px;
            color: var(--dark);
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
        }

        .menu-toggle:hover {
            background: var(--light);
        }

        .page-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
        }

        .topbar-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), #8b5cf6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: white;
            font-size: 16px;
        }

        /* ========== CONTENT AREA ========== */
        .content-wrapper {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-subtitle {
            color: var(--secondary);
            font-size: 16px;
            margin-top: 8px;
        }

        /* ========== STATS GRID ========== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 24px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border-top: 4px solid var(--primary);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .stat-icon {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            color: white;
            font-size: 24px;
        }

        .stat-content h3 {
            font-size: 14px;
            color: var(--secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 800;
            color: var(--dark);
            margin-bottom: 8px;
            line-height: 1;
        }

        .stat-change {
            font-size: 14px;
            color: var(--success);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .stat-change.negative {
            color: var(--danger);
        }

        /* ========== CHARTS ========== */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .chart-card {
            background: var(--card-bg);
            padding: 24px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
        }

        .chart-container {
            height: 300px;
            position: relative;
        }

        /* ========== DATA TABLES ========== */
        .data-section {
            margin-bottom: 32px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--dark);
        }

        .section-actions {
            display: flex;
            gap: 12px;
        }

        .data-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .card-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
        }

        .card-tools {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .search-box {
            position: relative;
            width: 300px;
        }

        .search-box input {
            width: 100%;
            padding: 10px 16px 10px 40px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 14px;
            transition: var(--transition);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--secondary);
        }

        .filter-select {
            padding: 10px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--card-bg);
            font-size: 14px;
            color: var(--dark);
            cursor: pointer;
            min-width: 150px;
        }

        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .data-table th {
            background: var(--light);
            padding: 18px 24px;
            text-align: left;
            font-weight: 600;
            color: var(--secondary);
            border-bottom: 1px solid var(--border);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .data-table td {
            padding: 18px 24px;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
            font-size: 14px;
        }

        .data-table tr {
            transition: var(--transition);
        }

        .data-table tr:hover {
            background: var(--light);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        /* ========== STATUS BADGES ========== */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .status-active { background: #d1fae5; color: #065f46; }
        .status-pending { background: #fef3c7; color: #92400e; }
        .status-inactive { background: #fee2e2; color: #991b1b; }
        .status-online { background: #d1fae5; color: #065f46; }
        .status-offline { background: #f1f5f9; color: #64748b; }
        .status-completed { background: #dbeafe; color: #1e40af; }
        .status-ongoing { background: #f3e8ff; color: #6b21a8; }

        /* ========== USER AVATAR ========== */
        .user-cell {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            background: linear-gradient(135deg, var(--primary), #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 16px;
            flex-shrink: 0;
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 2px;
        }

        .user-email {
            font-size: 12px;
            color: var(--secondary);
        }

        /* ========== BUTTONS ========== */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border: none;
            border-radius: var(--radius);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--border);
            color: var(--dark);
        }

        .btn-outline:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: rgba(16, 185, 129, 0.05);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-icon {
            padding: 8px;
            width: 36px;
            height: 36px;
            justify-content: center;
        }

        /* ========== LOGIN SCREEN ========== */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 10000;
        }

        .login-box {
            background: white;
            border-radius: 16px;
            padding: 40px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: loginFadeIn 0.5s ease;
        }

        @keyframes loginFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo {
            width: 80px;
            height: 80px;
            background: var(--primary);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 32px;
            color: white;
            margin: 0 auto 20px;
        }

        .login-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 8px;
        }

        .login-subtitle {
            color: var(--secondary);
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-size: 16px;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .login-info {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #166534;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .login-error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #991b1b;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        /* ========== MODAL ========== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(4px);
        }

        .modal.show {
            display: flex;
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: var(--radius);
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--card-bg);
            z-index: 10;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            color: var(--secondary);
            cursor: pointer;
            padding: 4px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }

        .close-btn:hover {
            background: var(--light);
            color: var(--danger);
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            padding: 24px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            position: sticky;
            bottom: 0;
            background: var(--card-bg);
        }

        /* ========== DETAILS VIEW ========== */
        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .detail-item {
            padding: 20px;
            background: var(--light);
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .detail-label {
            font-size: 12px;
            color: var(--secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            display: block;
        }

        .detail-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--dark);
            line-height: 1.4;
        }

        .document-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .document-item {
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
            transition: var(--transition);
        }

        .document-item:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .document-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: var(--light);
            display: block;
        }

        .document-info {
            padding: 12px;
            background: var(--card-bg);
        }

        .document-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--dark);
        }

        .document-meta {
            font-size: 12px;
            color: var(--secondary);
        }

        /* ========== LOADING & EMPTY STATES ========== */
        .loading {
            text-align: center;
            padding: 60px 24px;
            color: var(--secondary);
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 24px;
            color: var(--secondary);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--dark);
        }

        .empty-description {
            font-size: 14px;
            max-width: 400px;
            margin: 0 auto;
        }

        /* ========== PAGINATION ========== */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 8px;
            padding: 24px;
            border-top: 1px solid var(--border);
        }

        .page-btn {
            padding: 8px 16px;
            border: 1px solid var(--border);
            background: var(--card-bg);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
            font-weight: 500;
        }

        .page-btn:hover:not(.active) {
            background: var(--light);
            border-color: var(--primary);
        }

        .page-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* ========== TOAST NOTIFICATIONS ========== */
        .toast-container {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 400px;
        }

        .toast {
            background: var(--card-bg);
            border-left: 4px solid var(--success);
            border-radius: var(--radius);
            padding: 16px 20px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            animation: slideInRight 0.3s ease;
            transform: translateX(0);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-error { border-left-color: var(--danger); }
        .toast-warning { border-left-color: var(--warning); }
        .toast-info { border-left-color: var(--info); }

        .toast-content {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            flex: 1;
        }

        .toast-icon {
            font-size: 20px;
            flex-shrink: 0;
        }

        .toast-message {
            flex: 1;
            font-size: 14px;
            line-height: 1.4;
        }

        .toast-close {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--secondary);
            cursor: pointer;
            padding: 0 0 0 16px;
            opacity: 0.7;
            transition: var(--transition);
        }

        .toast-close:hover {
            opacity: 1;
            color: var(--dark);
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 1200px) {
            .sidebar {
                position: fixed;
                left: -280px;
                top: 0;
                bottom: 0;
                transition: var(--transition);
            }
            
            .sidebar.show {
                left: 0;
                box-shadow: 0 0 50px rgba(0, 0, 0, 0.3);
            }
            
            .menu-toggle {
                display: block;
            }
            
            .main-content {
                width: 100%;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .search-box {
                width: 200px;
            }
        }

        @media (max-width: 768px) {
            .content-wrapper {
                padding: 20px;
            }
            
            .topbar {
                padding: 0 20px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .card-header {
                flex-direction: column;
                gap: 16px;
                align-items: stretch;
            }
            
            .card-tools {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box {
                width: 100%;
            }
            
            .section-header {
                flex-direction: column;
                gap: 16px;
                align-items: stretch;
            }
            
            .section-actions {
                flex-wrap: wrap;
            }
            
            .modal-content {
                margin: 10px;
            }
        }

        @media (max-width: 480px) {
            .details-grid {
                grid-template-columns: 1fr;
            }
            
            .document-gallery {
                grid-template-columns: 1fr;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .modal-footer {
                flex-direction: column;
            }
        }

        /* ========== UTILITY CLASSES ========== */
        .d-none { display: none !important; }
        .d-flex { display: flex; }
        .d-block { display: block; }
        .align-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 12px; }
        .gap-4 { gap: 24px; }
        .mt-3 { margin-top: 24px; }
        .mb-3 { margin-bottom: 24px; }
        .ml-auto { margin-left: auto; }
        .text-center { text-align: center; }
        .text-success { color: var(--success); }
        .text-danger { color: var(--danger); }
        .text-warning { color: var(--warning); }
        .text-muted { color: var(--secondary); }
    </style>
</head>
<body>
    <!-- Login Screen (Shows first if not logged in) -->
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <div class="login-header">
                <div class="login-logo">F</div>
                <h1 class="login-title">FOOTMAN Admin</h1>
                <p class="login-subtitle">Business Administration Panel</p>
            </div>
            
            <div class="login-info">
                üí° <strong>Default Admin Credentials:</strong><br>
                Phone: <code>01700000000</code><br>
                Password: <code>admin123</code>
            </div>
            
            <div class="form-group">
                <label class="form-label">Phone Number</label>
                <input type="tel" id="loginPhone" class="form-control" value="01700000000" placeholder="Enter phone number">
            </div>
            
            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" id="loginPassword" class="form-control" placeholder="Enter password">
            </div>
            
            <div class="login-error" id="loginError"></div>
            
            <button class="btn btn-primary" id="loginBtn" style="width: 100%; padding: 16px; font-size: 16px;">
                üîí Login to Admin Panel
            </button>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Main App Container (Hidden until login) -->
    <div class="app-container d-none" id="appContainer">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">F</div>
                    <div class="logo-text">
                        <h2>FOOTMAN</h2>
                        <span>Business Admin</span>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="nav-menu">
                <div class="nav-section">
                    <div class="nav-section-title">Main</div>
                    <button class="nav-item active" data-page="dashboard">
                        üìä Dashboard
                    </button>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">User Management</div>
                    <button class="nav-item" data-page="users">
                        üë• All Users
                        <span class="nav-badge badge-info" id="usersBadge">0</span>
                    </button>
                    <button class="nav-item" data-page="partners">
                        üöö Delivery Partners
                        <span class="nav-badge badge-success" id="partnersBadge">0</span>
                    </button>
                    <button class="nav-item" data-page="customers">
                        üë§ Customers
                        <span class="nav-badge badge-info" id="customersBadge">0</span>
                    </button>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Business Operations</div>
                    <button class="nav-item" data-page="requests">
                        üì¶ Delivery Requests
                        <span class="nav-badge badge-warning" id="requestsBadge">0</span>
                    </button>
                    <button class="nav-item" data-page="earnings">
                        üí∞ Earnings & Reports
                    </button>
                    <button class="nav-item" data-page="online">
                        üìç Online Partners
                        <span class="nav-badge badge-success" id="onlineBadge">0</span>
                    </button>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Verification</div>
                    <button class="nav-item" data-page="pending">
                        ‚è≥ Pending Approvals
                        <span class="nav-badge badge-danger" id="pendingBadge">0</span>
                    </button>
                    <button class="nav-item" data-page="documents">
                        üìÑ Document Verification
                    </button>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="user-menu">
                    <div class="user-avatar" id="adminAvatar">A</div>
                    <div>
                        <div class="user-name">Admin User</div>
                        <div class="user-email">admin@footman.com</div>
                    </div>
                </div>
                <button class="btn btn-secondary btn-sm mt-3" id="logoutBtn" style="width: 100%;">
                    üö™ Logout
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <header class="topbar">
                <div class="topbar-left">
                    <button class="menu-toggle" id="menuToggle">‚ò∞</button>
                    <h1 class="page-title" id="pageTitle">Dashboard</h1>
                </div>
                <div class="topbar-right">
                    <div class="user-menu">
                        <span id="currentTime"></span>
                        <div class="user-avatar" id="topbarAvatar">A</div>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content-wrapper">
                <!-- Dashboard Page -->
                <section class="page-content" id="dashboardPage">
                    <div class="page-header">
                        <h1 class="page-title">Business Dashboard</h1>
                        <p class="page-subtitle">Real-time overview of your delivery business</p>
                    </div>

                    <!-- Stats Grid -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">üí∞</div>
                            <div class="stat-content">
                                <h3>Total Revenue</h3>
                                <div class="stat-value" id="totalRevenue">‡ß≥ 0</div>
                                <div class="stat-change" id="revenueChange">
                                    <span>‚Üó</span> Loading...
                                </div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon">üë•</div>
                            <div class="stat-content">
                                <h3>Total Users</h3>
                                <div class="stat-value" id="totalUsers">0</div>
                                <div class="stat-change">
                                    <span>‚Üó</span> <span id="onlineUsers">0</span> online
                                </div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon">üì¶</div>
                            <div class="stat-content">
                                <h3>Total Requests</h3>
                                <div class="stat-value" id="totalRequests">0</div>
                                <div class="stat-change">
                                    <span>‚Üó</span> <span id="todayRequests">0</span> today
                                </div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon">üöö</div>
                            <div class="stat-content">
                                <h3>Delivery Partners</h3>
                                <div class="stat-value" id="totalPartners">0</div>
                                <div class="stat-change">
                                    <span>‚Üó</span> <span id="onlinePartners">0</span> online
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Section -->
                    <div class="charts-grid">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">Revenue Overview</h3>
                                <select class="filter-select" id="revenuePeriod">
                                    <option value="7days">Last 7 Days</option>
                                    <option value="30days">Last 30 Days</option>
                                    <option value="90days">Last 90 Days</option>
                                </select>
                            </div>
                            <div class="chart-container" id="revenueChart">
                                <div class="loading">
                                    <div class="loading-spinner"></div>
                                    <p>Loading revenue data...</p>
                                </div>
                            </div>
                        </div>

                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">Request Status</h3>
                            </div>
                            <div class="chart-container" id="requestsChart">
                                <div class="loading">
                                    <div class="loading-spinner"></div>
                                    <p>Loading request data...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="data-section">
                        <div class="section-header">
                            <h3 class="section-title">Recent Activity</h3>
                            <div class="section-actions">
                                <button class="btn btn-outline btn-sm" id="refreshActivity">
                                    üîÑ Refresh
                                </button>
                            </div>
                        </div>
                        <div class="data-card">
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Time</th>
                                            <th>User</th>
                                            <th>Activity</th>
                                            <th>Status</th>
                                            <th>Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody id="activityTable">
                                        <tr>
                                            <td colspan="5" class="loading">
                                                <div class="loading-spinner"></div>
                                                <p>Loading activity...</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- All Users Page -->
                <section class="page-content d-none" id="usersPage">
                    <div class="page-header">
                        <h1 class="page-title">User Management</h1>
                        <p class="page-subtitle">Manage all user accounts in the system</p>
                    </div>

                    <div class="data-card">
                        <div class="card-header">
                            <h3 class="card-title">All Users</h3>
                            <div class="card-tools">
                                <div class="search-box">
                                    <span class="search-icon">üîç</span>
                                    <input type="text" id="userSearch" placeholder="Search users...">
                                </div>
                                <select class="filter-select" id="userTypeFilter">
                                    <option value="">All Types</option>
                                    <option value="admin">Admin</option>
                                    <option value="delivery">Delivery Partner</option>
                                    <option value="customer">Customer</option>
                                </select>
                                <select class="filter-select" id="userStatusFilter">
                                    <option value="">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                    <option value="pending">Pending</option>
                                </select>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>User</th>
                                        <th>Contact</th>
                                        <th>Type</th>
                                        <th>Status</th>
                                        <th>Online</th>
                                        <th>Joined</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTable">
                                    <tr>
                                        <td colspan="8" class="loading">
                                            <div class="loading-spinner"></div>
                                            <p>Loading users...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="pagination" id="usersPagination"></div>
                    </div>
                </section>

                <!-- Delivery Partners Page -->
                <section class="page-content d-none" id="partnersPage">
                    <div class="page-header">
                        <h1 class="page-title">Delivery Partners</h1>
                        <p class="page-subtitle">Manage and monitor delivery partners</p>
                    </div>

                    <div class="data-card">
                        <div class="card-header">
                            <h3 class="card-title">Delivery Partners</h3>
                            <div class="card-tools">
                                <div class="search-box">
                                    <span class="search-icon">üîç</span>
                                    <input type="text" id="partnerSearch" placeholder="Search partners...">
                                </div>
                                <select class="filter-select" id="partnerStatusFilter">
                                    <option value="">All Status</option>
                                    <option value="online">Online</option>
                                    <option value="offline">Offline</option>
                                    <option value="active">Active</option>
                                    <option value="pending">Pending</option>
                                </select>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Partner</th>
                                        <th>Contact</th>
                                        <th>NID</th>
                                        <th>Status</th>
                                        <th>Online</th>
                                        <th>Documents</th>
                                        <th>Rating</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="partnersTable">
                                    <tr>
                                        <td colspan="8" class="loading">
                                            <div class="loading-spinner"></div>
                                            <p>Loading partners...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Partner Documents Section -->
                    <div class="data-section mt-3">
                        <div class="section-header">
                            <h3 class="section-title">Document Verification Queue</h3>
                        </div>
                        <div class="data-card">
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Partner</th>
                                            <th>Profile Photo</th>
                                            <th>NID Front</th>
                                            <th>NID Back</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="documentsTable">
                                        <tr>
                                            <td colspan="6" class="loading">
                                                <div class="loading-spinner"></div>
                                                <p>Loading documents...</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Customers Page -->
                <section class="page-content d-none" id="customersPage">
                    <div class="page-header">
                        <h1 class="page-title">Customers</h1>
                        <p class="page-subtitle">Manage customer accounts and view activity</p>
                    </div>

                    <div class="data-card">
                        <div class="card-header">
                            <h3 class="card-title">All Customers</h3>
                            <div class="card-tools">
                                <div class="search-box">
                                    <span class="search-icon">üîç</span>
                                    <input type="text" id="customerSearch" placeholder="Search customers...">
                                </div>
                                <select class="filter-select" id="customerActivityFilter">
                                    <option value="">All Activity</option>
                                    <option value="active">Active (Last 30 days)</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Customer</th>
                                        <th>Contact</th>
                                        <th>Total Orders</th>
                                        <th>Total Spent</th>
                                        <th>Last Order</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="customersTable">
                                    <tr>
                                        <td colspan="7" class="loading">
                                            <div class="loading-spinner"></div>
                                            <p>Loading customers...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Delivery Requests Page -->
                <section class="page-content d-none" id="requestsPage">
                    <div class="page-header">
                        <h1 class="page-title">Delivery Requests</h1>
                        <p class="page-subtitle">Monitor and manage all delivery requests</p>
                    </div>

                    <div class="data-card">
                        <div class="card-header">
                            <h3 class="card-title">All Requests</h3>
                            <div class="card-tools">
                                <div class="search-box">
                                    <span class="search-icon">üîç</span>
                                    <input type="text" id="requestSearch" placeholder="Search requests...">
                                </div>
                                <select class="filter-select" id="requestStatusFilter">
                                    <option value="">All Status</option>
                                    <option value="pending">Pending</option>
                                    <option value="accepted">Accepted</option>
                                    <option value="ongoing">Ongoing</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                                <select class="filter-select" id="requestDateFilter">
                                    <option value="">All Time</option>
                                    <option value="today">Today</option>
                                    <option value="week">This Week</option>
                                    <option value="month">This Month</option>
                                </select>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Request #</th>
                                        <th>Customer</th>
                                        <th>Partner</th>
                                        <th>Status</th>
                                        <th>Amount</th>
                                        <th>Commission</th>
                                        <th>Payment</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="requestsTable">
                                    <tr>
                                        <td colspan="9" class="loading">
                                            <div class="loading-spinner"></div>
                                            <p>Loading requests...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="pagination" id="requestsPagination"></div>
                    </div>
                </section>

                <!-- Earnings Page -->
                <section class="page-content d-none" id="earningsPage">
                    <div class="page-header">
                        <h1 class="page-title">Earnings & Reports</h1>
                        <p class="page-subtitle">Financial overview and business reports</p>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">üí∞</div>
                            <div class="stat-content">
                                <h3>Total Revenue</h3>
                                <div class="stat-value" id="earningsRevenue">‡ß≥ 0</div>
                                <div class="stat-change">All time</div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon">üè¶</div>
                            <div class="stat-content">
                                <h3>Your Commission</h3>
                                <div class="stat-value" id="totalCommission">‡ß≥ 0</div>
                                <div class="stat-change">10% of revenue</div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon">üöö</div>
                            <div class="stat-content">
                                <h3>Partner Earnings</h3>
                                <div class="stat-value" id="partnerEarnings">‡ß≥ 0</div>
                                <div class="stat-change">90% of revenue</div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon">üìä</div>
                            <div class="stat-content">
                                <h3>Avg. Per Request</h3>
                                <div class="stat-value" id="avgPerRequest">‡ß≥ 0</div>
                                <div class="stat-change">Commission: ‡ß≥0</div>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Methods -->
                    <div class="data-section">
                        <div class="section-header">
                            <h3 class="section-title">Payment Methods</h3>
                            <select class="filter-select" id="earningsPeriod">
                                <option value="all">All Time</option>
                                <option value="month">This Month</option>
                                <option value="week">This Week</option>
                                <option value="today">Today</option>
                            </select>
                        </div>
                        <div class="data-card">
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Payment Method</th>
                                            <th>Total Requests</th>
                                            <th>Total Amount</th>
                                            <th>Commission</th>
                                            <th>Percentage</th>
                                        </tr>
                                    </thead>
                                    <tbody id="paymentsTable">
                                        <tr>
                                            <td colspan="5" class="loading">
                                                <div class="loading-spinner"></div>
                                                <p>Loading payment data...</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Transaction History -->
                    <div class="data-section">
                        <div class="section-header">
                            <h3 class="section-title">Recent Transactions</h3>
                            <button class="btn btn-outline btn-sm" id="exportEarnings">
                                üìä Export Report
                            </button>
                        </div>
                        <div class="data-card">
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Request #</th>
                                            <th>Customer</th>
                                            <th>Partner</th>
                                            <th>Amount</th>
                                            <th>Commission</th>
                                            <th>Method</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="transactionsTable">
                                        <tr>
                                            <td colspan="8" class="loading">
                                                <div class="loading-spinner"></div>
                                                <p>Loading transactions...</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Online Partners Page -->
                <section class="page-content d-none" id="onlinePage">
                    <div class="page-header">
                        <h1 class="page-title">Online Partners</h1>
                        <p class="page-subtitle">Partners currently available for deliveries</p>
                    </div>

                    <div class="data-card">
                        <div class="card-header">
                            <h3 class="card-title">Currently Online</h3>
                            <div class="card-tools">
                                <button class="btn btn-outline btn-sm" id="refreshOnline">
                                    üîÑ Refresh Status
                                </button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Partner</th>
                                        <th>Status</th>
                                        <th>Current Job</th>
                                        <th>Location</th>
                                        <th>Rating</th>
                                        <th>Last Active</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="onlineTable">
                                    <tr>
                                        <td colspan="7" class="loading">
                                            <div class="loading-spinner"></div>
                                            <p>Loading online partners...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Map View (Placeholder) -->
                    <div class="data-section mt-3">
                        <div class="section-header">
                            <h3 class="section-title">Partner Locations</h3>
                        </div>
                        <div class="data-card">
                            <div style="height: 400px; background: var(--light); border-radius: var(--radius); display: flex; align-items: center; justify-content: center; color: var(--secondary);">
                                üó∫Ô∏è Map view would show partner locations here
                                <br>
                                <small>(Requires Google Maps integration)</small>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Pending Approvals Page -->
                <section class="page-content d-none" id="pendingPage">
                    <div class="page-header">
                        <h1 class="page-title">Pending Approvals</h1>
                        <p class="page-subtitle">Approve or reject new delivery partners</p>
                    </div>

                    <div class="data-card">
                        <div class="card-header">
                            <h3 class="card-title">Partners Awaiting Approval</h3>
                            <div class="card-tools">
                                <button class="btn btn-outline btn-sm" id="refreshPending">
                                    üîÑ Refresh
                                </button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Applicant</th>
                                        <th>Applied</th>
                                        <th>Documents</th>
                                        <th>NID Verified</th>
                                        <th>Contact</th>
                                        <th>Emergency Contact</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="pendingTable">
                                    <tr>
                                        <td colspan="7" class="loading">
                                            <div class="loading-spinner"></div>
                                            <p>Loading pending approvals...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Document Verification Page -->
                <section class="page-content d-none" id="documentsPage">
                    <div class="page-header">
                        <h1 class="page-title">Document Verification</h1>
                        <p class="page-subtitle">Verify partner documents and identity</p>
                    </div>

                    <div class="data-card">
                        <div class="card-header">
                            <h3 class="card-title">Document Gallery</h3>
                            <div class="card-tools">
                                <select class="filter-select" id="docStatusFilter">
                                    <option value="">All Documents</option>
                                    <option value="verified">Verified</option>
                                    <option value="pending">Pending Review</option>
                                    <option value="rejected">Rejected</option>
                                </select>
                            </div>
                        </div>
                        <div class="document-gallery" id="documentGallery">
                            <div class="loading" style="grid-column: 1 / -1;">
                                <div class="loading-spinner"></div>
                                <p>Loading documents...</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- User Details Modal -->
    <div class="modal" id="userModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">User Details</h2>
                <button class="close-btn" id="closeModal">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading user details...</p>
                </div>
            </div>
            <div class="modal-footer" id="modalFooter"></div>
        </div>
    </div>

    <!-- Partner Documents Modal -->
    <div class="modal" id="documentsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="documentsTitle">Partner Documents</h2>
                <button class="close-btn" id="closeDocumentsModal">&times;</button>
            </div>
            <div class="modal-body" id="documentsBody">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading documents...</p>
                </div>
            </div>
            <div class="modal-footer" id="documentsFooter"></div>
        </div>
    </div>

    <!-- Request Details Modal -->
    <div class="modal" id="requestModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="requestTitle">Request Details</h2>
                <button class="close-btn" id="closeRequestModal">&times;</button>
            </div>
            <div class="modal-body" id="requestBody">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading request details...</p>
                </div>
            </div>
            <div class="modal-footer" id="requestFooter"></div>
        </div>
    </div>

    <script>
        // ========== CONFIGURATION ==========
        const Config = {
            API_BASE: 'https://footman-backend.onrender.com/api/v1',
            TOKEN_KEY: 'footman_admin_token',
            USER_KEY: 'footman_admin_user',
            REFRESH_INTERVAL: 30000,
            ITEMS_PER_PAGE: 20
        };

        // ========== STATE MANAGEMENT ==========
        const State = {
            token: null,
            currentPage: 'dashboard',
            currentUser: null,
            isLoading: false,
            data: {
                users: [],
                partners: [],
                customers: [],
                requests: [],
                earnings: null
            },
            filters: {
                users: {},
                partners: {},
                requests: {},
                earnings: {}
            }
        };

        // ========== AUTHENTICATION ==========
        function initAuth() {
            // Check URL token first
            const urlParams = new URLSearchParams(window.location.search);
            const urlToken = urlParams.get("token");
            
            if (urlToken) {
                State.token = urlToken;
                localStorage.setItem(Config.TOKEN_KEY, urlToken);
                window.history.replaceState({}, document.title, window.location.pathname);
                showApp();
                return;
            }
            
            // Check localStorage
            State.token = localStorage.getItem(Config.TOKEN_KEY);
            
            if (State.token) {
                showApp();
            } else {
                showLogin();
            }
        }
        
        function showLogin() {
            document.getElementById("loginScreen").style.display = "flex";
            document.getElementById("appContainer").classList.add("d-none");
        }
        
        function showApp() {
            document.getElementById("loginScreen").style.display = "none";
            document.getElementById("appContainer").classList.remove("d-none");
            initApp();
        }                errorDisplay.textContent = error.message;
                errorDisplay.style.display = 'block';
                showToast(error.message, 'error');
            } finally {
                loginBtn.textContent = originalText;
                loginBtn.disabled = false;
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                State.token = null;
                State.currentUser = null;
                localStorage.removeItem(Config.TOKEN_KEY);
                localStorage.removeItem(Config.USER_KEY);
                showLogin();
            }
        }

        // ========== API SERVICE ==========
        async function apiRequest(endpoint, options = {}) {
            if (!State.token) {
                showLogin();
                throw new Error('Not authenticated');
            }
            
            const url = `${Config.API_BASE}${endpoint}`;
            const headers = {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${State.token}`,
                ...options.headers
            };
            
            try {
                const response = await fetch(url, { ...options, headers });
                
                if (response.status === 401) {
                    showToast('Session expired. Please login again.', 'error');
                    logout();
                    return null;
                }
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                showToast(`API Error: ${error.message}`, 'error');
                throw error;
            }
        }

        // ========== UI UTILITIES ==========
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };
            
            toast.innerHTML = `
                <div class="toast-content">
                    <span class="toast-icon">${icons[type] || icons.info}</span>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="this.parentElement.remove()">√ó</button>
            `;
            
            container.appendChild(toast);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 5000);
        }

        function formatCurrency(amount) {
            return `‡ß≥ ${parseFloat(amount || 0).toFixed(2)}`;
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
        }

        function formatDateTime(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleString('en-US', {
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function formatTimeAgo(dateString) {
            if (!dateString) return 'Never';
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            return `${Math.floor(diffHours / 24)}d ago`;
        }

        function getInitials(name) {
            if (!name) return '?';
            return name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
        }

        function setLoading(loading) {
            State.isLoading = loading;
            document.body.style.cursor = loading ? 'wait' : 'default';
        }

        // ========== NAVIGATION ==========
        function setupNavigation() {
            // Sidebar toggle
            document.getElementById('menuToggle').addEventListener('click', () => {
                document.getElementById('sidebar').classList.toggle('show');
            });
            
            // Page navigation
            document.querySelectorAll('.nav-item').forEach(btn => {
                btn.addEventListener('click', () => {
                    const page = btn.dataset.page;
                    switchPage(page);
                    // Close sidebar on mobile
                    if (window.innerWidth <= 1200) {
                        document.getElementById('sidebar').classList.remove('show');
                    }
                });
            });
            
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            // Login button
            document.getElementById('loginBtn').addEventListener('click', () => {
                const phone = document.getElementById('loginPhone').value;
                const password = document.getElementById('loginPassword').value;
                if (!phone || !password) {
                    document.getElementById('loginError').textContent = 'Please enter phone and password';
                    document.getElementById('loginError').style.display = 'block';
                    return;
                }
                login(phone, password);
            });
            
            // Enter key in login form
            document.getElementById('loginPassword').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    document.getElementById('loginBtn').click();
                }
            });
            
            // Modal close buttons
            document.getElementById('closeModal').addEventListener('click', () => {
                document.getElementById('userModal').classList.remove('show');
            });
            
            document.getElementById('closeDocumentsModal').addEventListener('click', () => {
                document.getElementById('documentsModal').classList.remove('show');
            });
            
            document.getElementById('closeRequestModal').addEventListener('click', () => {
                document.getElementById('requestModal').classList.remove('show');
            });
            
            // Close modals on outside click
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('show');
                    }
                });
            });
            
            // Update time
            function updateTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: true
                });
                document.getElementById('currentTime').textContent = timeString;
            }
            updateTime();
            setInterval(updateTime, 60000);
        }

        function switchPage(page) {
            State.currentPage = page;
            
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.page === page);
            });
            
            // Update page title
            const titles = {
                dashboard: 'Dashboard',
                users: 'User Management',
                partners: 'Delivery Partners',
                customers: 'Customers',
                requests: 'Delivery Requests',
                earnings: 'Earnings & Reports',
                online: 'Online Partners',
                pending: 'Pending Approvals',
                documents: 'Document Verification'
            };
            
            document.getElementById('pageTitle').textContent = titles[page] || 'Dashboard';
            
            // Show/hide pages
            document.querySelectorAll('.page-content').forEach(content => {
                content.classList.toggle('d-none', content.id !== `${page}Page`);
            });
            
            // Load page data
            loadPageData(page);
        }

        // ========== DATA LOADING ==========
        async function loadPageData(page) {
            setLoading(true);
            
            try {
                switch(page) {
                    case 'dashboard':
                        await loadDashboard();
                        break;
                    case 'users':
                        await loadUsers();
                        break;
                    case 'partners':
                        await loadPartners();
                        break;
                    case 'customers':
                        await loadCustomers();
                        break;
                    case 'requests':
                        await loadRequests();
                        break;
                    case 'earnings':
                        await loadEarnings();
                        break;
                    case 'online':
                        await loadOnlinePartners();
                        break;
                    case 'pending':
                        await loadPendingApprovals();
                        break;
                    case 'documents':
                        await loadDocumentVerification();
                        break;
                }
            } catch (error) {
                console.error(`Error loading ${page}:`, error);
                showToast(`Failed to load ${page} data`, 'error');
            } finally {
                setLoading(false);
            }
        }

        async function loadDashboard() {
            try {
                // Load dashboard stats
                const stats = await apiRequest('/admin/dashboard');
                if (stats?.success) {
                    updateDashboardStats(stats.data.stats);
                }
                
                // Load users for counts
                const users = await apiRequest('/admin/users?limit=100');
                if (users?.success) {
                    updateUserCounts(users.data.users);
                }
                
                // Update recent activity with real data
                updateRecentActivity();
                
            } catch (error) {
                console.error('Dashboard load error:', error);
                showToast('Failed to load dashboard data', 'error');
            }
        }

        function updateDashboardStats(stats) {
            // Use REAL data from API
            document.getElementById('totalRevenue').textContent = formatCurrency(stats.total_revenue || 0);
            document.getElementById('totalRequests').textContent = stats.total_requests || 0;
            document.getElementById('todayRequests').textContent = stats.today_requests || 0;
            
            // Update revenue change indicator
            const revenueChange = document.getElementById('revenueChange');
            if (stats.total_revenue > 0) {
                revenueChange.innerHTML = `<span>‚Üó</span> ${formatCurrency(stats.total_revenue)} total`;
            } else {
                revenueChange.innerHTML = `<span>‚Üí</span> No revenue yet`;
            }
            
            // Update badges with real data
            document.getElementById('requestsBadge').textContent = stats.total_requests || 0;
        }

        function updateUserCounts(users) {
            const totalUsers = users.length;
            const partners = users.filter(u => u.user_type === 'delivery');
            const customers = users.filter(u => u.user_type === 'customer');
            const onlinePartners = partners.filter(p => p.is_online).length;
            const activePartners = partners.filter(p => p.is_active).length;
            
            document.getElementById('totalUsers').textContent = totalUsers;
            document.getElementById('totalPartners').textContent = partners.length;
            document.getElementById('onlinePartners').textContent = onlinePartners;
            document.getElementById('onlineUsers').textContent = onlinePartners;
            
            // Update badges with REAL data
            document.getElementById('usersBadge').textContent = totalUsers;
            document.getElementById('partnersBadge').textContent = partners.length;
            document.getElementById('customersBadge').textContent = customers.length;
            document.getElementById('onlineBadge').textContent = onlinePartners;
            document.getElementById('pendingBadge').textContent = partners.filter(p => !p.is_active).length;
            
            // Store for later use
            State.data.users = users;
            State.data.partners = partners;
            State.data.customers = customers;
        }

        async function updateRecentActivity() {
            try {
                // Load real requests for activity
                const requests = await apiRequest('/admin/requests?limit=10');
                if (!requests?.success) return;
                
                const activityTable = document.getElementById('activityTable');
                const recentRequests = requests.data.requests.slice(0, 5);
                
                if (recentRequests.length === 0) {
                    activityTable.innerHTML = `
                        <tr>
                            <td colspan="5" class="empty-state">
                                <div class="empty-icon">üì≠</div>
                                <div class="empty-title">No recent activity</div>
                                <div class="empty-description">No delivery requests yet.</div>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                activityTable.innerHTML = recentRequests.map(req => {
                    const statusIcons = {
                        completed: '‚úÖ',
                        cancelled: '‚ùå',
                        searching: 'üîç',
                        accepted: '‚úÖ'
                    };
                    
                    const statusLabels = {
                        completed: 'Completed',
                        cancelled: 'Cancelled',
                        searching: 'Searching',
                        accepted: 'Accepted'
                    };
                    
                    return `
                        <tr>
                            <td>${formatTimeAgo(req.created_at)}</td>
                            <td>
                                <div class="user-cell">
                                    <div class="avatar">${getInitials(req.customer?.full_name)}</div>
                                    <div class="user-info">
                                        <div class="user-name">${req.customer?.full_name || 'Customer'}</div>
                                        <div class="user-email">${req.customer?.phone || ''}</div>
                                    </div>
                                </div>
                            </td>
                            <td>Delivery request ${req.request_number}</td>
                            <td>
                                <span class="status-badge status-${req.request_status}">
                                    ${statusIcons[req.request_status] || '‚è≥'}
                                    ${statusLabels[req.request_status] || req.request_status}
                                </span>
                            </td>
                            <td><strong>${formatCurrency(req.base_price)}</strong></td>
                        </tr>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Activity load error:', error);
            }
        }

        async function loadUsers() {
            try {
                const result = await apiRequest('/admin/users?limit=100');
                if (result?.success) {
                    renderUsersTable(result.data.users);
                }
            } catch (error) {
                console.error('Users load error:', error);
                document.getElementById('usersTable').innerHTML = `
                    <tr>
                        <td colspan="8" class="empty-state">
                            <div class="empty-icon">‚ö†Ô∏è</div>
                            <div class="empty-title">Failed to load users</div>
                            <div class="empty-description">${error.message}</div>
                        </td>
                    </tr>
                `;
            }
        }

        function renderUsersTable(users) {
            const tbody = document.getElementById('usersTable');
            
            if (!users || users.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="empty-state">
                            <div class="empty-icon">üë•</div>
                            <div class="empty-title">No users found</div>
                            <div class="empty-description">No users are registered in the system yet.</div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = users.map(user => {
                const userType = user.user_type || 'customer';
                const isActive = user.is_active !== false;
                const isOnline = user.is_online === true;
                
                const typeBadges = {
                    admin: '<span class="status-badge status-active">üëë Admin</span>',
                    delivery: '<span class="status-badge status-active">üöö Partner</span>',
                    customer: '<span class="status-badge status-active">üë§ Customer</span>'
                };
                
                const statusBadge = isActive ? 
                    '<span class="status-badge status-active">‚úÖ Active</span>' : 
                    '<span class="status-badge status-pending">‚è≥ Inactive</span>';
                
                const onlineBadge = isOnline ?
                    '<span class="status-badge status-online">üü¢ Online</span>' :
                    '<span class="status-badge status-offline">‚ö´ Offline</span>';
                
                return `
                    <tr>
                        <td>${user.id}</td>
                        <td>
                            <div class="user-cell">
                                <div class="avatar">
                                    ${user.profile_image_url ? 
                                        `<img src="${user.profile_image_url}" alt="${user.full_name}">` : 
                                        getInitials(user.full_name)}
                                </div>
                                <div class="user-info">
                                    <div class="user-name">${user.full_name || 'N/A'}</div>
                                    <div class="user-email">${user.email || 'No email'}</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div>${user.phone || 'N/A'}</div>
                            <small class="text-muted">${user.emergency_contact_phone || 'No emergency contact'}</small>
                        </td>
                        <td>${typeBadges[userType] || typeBadges.customer}</td>
                        <td>${statusBadge}</td>
                        <td>${onlineBadge}</td>
                        <td>${formatDate(user.created_at)}</td>
                        <td>
                            <div class="d-flex gap-2">
                                <button class="btn btn-primary btn-sm" onclick="viewUserDetails(${user.id})">
                                    üëÅÔ∏è View
                                </button>
                                ${userType === 'delivery' && !isActive ? 
                                    `<button class="btn btn-success btn-sm" onclick="approveUser(${user.id})">
                                        ‚úì Approve
                                    </button>` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        async function loadPartners() {
            try {
                const users = await apiRequest('/admin/users?limit=100');
                if (users?.success) {
                    const partners = users.data.users.filter(u => u.user_type === 'delivery');
                    renderPartnersTable(partners);
                    renderDocumentsTable(partners);
                }
            } catch (error) {
                console.error('Partners load error:', error);
            }
        }

        function renderPartnersTable(partners) {
            const tbody = document.getElementById('partnersTable');
            
            if (!partners || partners.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="empty-state">
                            <div class="empty-icon">üöö</div>
                            <div class="empty-title">No delivery partners</div>
                            <div class="empty-description">No delivery partners are registered yet.</div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = partners.map(partner => {
                const isActive = partner.is_active !== false;
                const isOnline = partner.is_online === true;
                const hasProfile = partner.profile_image_url && partner.profile_image_url !== 'null';
                const hasNidFront = partner.nid_front_image_url && partner.nid_front_image_url !== 'null';
                const hasNidBack = partner.nid_back_image_url && partner.nid_back_image_url !== 'null';
                const docsCount = [hasProfile, hasNidFront, hasNidBack].filter(Boolean).length;
                
                const statusBadge = isActive ? 
                    '<span class="status-badge status-active">‚úÖ Active</span>' : 
                    '<span class="status-badge status-pending">‚è≥ Pending</span>';
                
                const onlineBadge = isOnline ?
                    '<span class="status-badge status-online">üü¢ Online</span>' :
                    '<span class="status-badge status-offline">‚ö´ Offline</span>';
                
                const docsBadge = docsCount > 0 ?
                    `<span class="status-badge status-active">üìÑ ${docsCount}/3</span>` :
                    '<span class="status-badge status-pending">‚ùå No docs</span>';
                
                return `
                    <tr>
                        <td>
                            <div class="user-cell">
                                <div class="avatar">
                                    ${hasProfile ? 
                                        `<img src="${partner.profile_image_url}" alt="${partner.full_name}">` : 
                                        getInitials(partner.full_name)}
                                </div>
                                <div class="user-info">
                                    <div class="user-name">${partner.full_name || 'N/A'}</div>
                                    <div class="user-email">${partner.nid_number || 'No NID'}</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div>${partner.phone || 'N/A'}</div>
                            <small class="text-muted">${partner.emergency_contact_phone || 'No emergency'}</small>
                        </td>
                        <td>${partner.nid_number || 'N/A'}</td>
                        <td>${statusBadge}</td>
                        <td>${onlineBadge}</td>
                        <td>${docsBadge}</td>
                        <td>${partner.rating || 'N/A'}/5</td>
                        <td>
                            <div class="d-flex gap-2">
                                <button class="btn btn-primary btn-sm" onclick="viewPartnerDetails(${partner.id})">
                                    üëÅÔ∏è View
                                </button>
                                <button class="btn btn-info btn-sm" onclick="viewPartnerDocuments(${partner.id})">
                                    üìÑ Docs
                                </button>
                                ${!isActive ? 
                                    `<button class="btn btn-success btn-sm" onclick="approvePartner(${partner.id})">
                                        ‚úì Approve
                                    </button>` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function renderDocumentsTable(partners) {
            const tbody = document.getElementById('documentsTable');
            const pendingPartners = partners.filter(p => !p.is_active);
            
            if (pendingPartners.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <div class="empty-icon">‚úÖ</div>
                            <div class="empty-title">All documents verified</div>
                            <div class="empty-description">No pending document verifications.</div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = pendingPartners.map(partner => {
                const hasProfile = partner.profile_image_url && partner.profile_image_url !== 'null';
                const hasNidFront = partner.nid_front_image_url && partner.nid_front_image_url !== 'null';
                const hasNidBack = partner.nid_back_image_url && partner.nid_back_image_url !== 'null';
                
                return `
                    <tr>
                        <td>
                            <div class="user-cell">
                                <div class="avatar">${getInitials(partner.full_name)}</div>
                                <div class="user-info">
                                    <div class="user-name">${partner.full_name || 'N/A'}</div>
                                    <div class="user-email">${partner.phone || 'N/A'}</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            ${hasProfile ? 
                                `<a href="${partner.profile_image_url}" target="_blank" class="btn btn-outline btn-sm">üëÅÔ∏è View</a>` :
                                '<span class="text-danger">‚ùå Missing</span>'}
                        </td>
                        <td>
                            ${hasNidFront ? 
                                `<a href="${partner.nid_front_image_url}" target="_blank" class="btn btn-outline btn-sm">üëÅÔ∏è View</a>` :
                                '<span class="text-danger">‚ùå Missing</span>'}
                        </td>
                        <td>
                            ${hasNidBack ? 
                                `<a href="${partner.nid_back_image_url}" target="_blank" class="btn btn-outline btn-sm">üëÅÔ∏è View</a>` :
                                '<span class="text-danger">‚ùå Missing</span>'}
                        </td>
                        <td>
                            <span class="status-badge status-pending">‚è≥ Pending Review</span>
                        </td>
                        <td>
                            <div class="d-flex gap-2">
                                <button class="btn btn-success btn-sm" onclick="approvePartner(${partner.id})">
                                    ‚úì Approve
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="rejectPartner(${partner.id})">
                                    ‚úó Reject
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        async function loadCustomers() {
            try {
                const users = await apiRequest('/admin/users?limit=100');
                if (users?.success) {
                    const customers = users.data.users.filter(u => u.user_type === 'customer');
                    renderCustomersTable(customers);
                }
            } catch (error) {
                console.error('Customers load error:', error);
            }
        }

        function renderCustomersTable(customers) {
            const tbody = document.getElementById('customersTable');
            
            if (!customers || customers.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <div class="empty-icon">üë§</div>
                            <div class="empty-title">No customers</div>
                            <div class="empty-description">No customers are registered yet.</div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = customers.map(customer => {
                const isActive = customer.is_active !== false;
                
                const statusBadge = isActive ? 
                    '<span class="status-badge status-active">‚úÖ Active</span>' : 
                    '<span class="status-badge status-inactive">‚ö´ Inactive</span>';
                
                return `
                    <tr>
                        <td>
                            <div class="user-cell">
                                <div class="avatar">${getInitials(customer.full_name)}</div>
                                <div class="user-info">
                                    <div class="user-name">${customer.full_name || 'N/A'}</div>
                                    <div class="user-email">${customer.email || 'No email'}</div>
                                </div>
                            </div>
                        </td>
                        <td>${customer.phone || 'N/A'}</td>
                        <td>0</td>
                        <td>${formatCurrency(0)}</td>
                        <td>Never</td>
                        <td>${statusBadge}</td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="viewUserDetails(${customer.id})">
                                üëÅÔ∏è View
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        async function loadRequests() {
            try {
                const result = await apiRequest('/admin/requests?limit=50');
                if (result?.success) {
                    renderRequestsTable(result.data.requests);
                    document.getElementById('requestsBadge').textContent = result.data.totals.total_requests || 0;
                }
            } catch (error) {
                console.error('Requests load error:', error);
                document.getElementById('requestsTable').innerHTML = `
                    <tr>
                        <td colspan="9" class="empty-state">
                            <div class="empty-icon">‚ö†Ô∏è</div>
                            <div class="empty-title">Failed to load requests</div>
                            <div class="empty-description">${error.message}</div>
                        </td>
                    </tr>
                `;
            }
        }

        function renderRequestsTable(requests) {
            const tbody = document.getElementById('requestsTable');
            
            if (!requests || requests.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="empty-state">
                            <div class="empty-icon">üì≠</div>
                            <div class="empty-title">No delivery requests</div>
                            <div class="empty-description">No delivery requests have been made yet.</div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = requests.map(req => {
                const statusBadges = {
                    completed: '<span class="status-badge status-completed">‚úÖ Completed</span>',
                    cancelled: '<span class="status-badge status-inactive">‚ùå Cancelled</span>',
                    searching: '<span class="status-badge status-pending">üîç Searching</span>',
                    accepted: '<span class="status-badge status-active">‚úÖ Accepted</span>'
                };
                
                const methodBadges = {
                    cash: '<span class="status-badge">üí∞ Cash</span>',
                    bkash: '<span class="status-badge" style="background:#E2136E;color:white;">bKash</span>',
                    nagad: '<span class="status-badge" style="background:#E30A17;color:white;">Nagad</span>'
                };
                
                return `
                    <tr>
                        <td>${req.request_number}</td>
                        <td>
                            <div class="user-cell">
                                <div class="avatar">${getInitials(req.customer?.full_name)}</div>
                                <div class="user-info">
                                    <div class="user-name">${req.customer?.full_name || 'Customer'}</div>
                                    <div class="user-email">${req.customer?.phone || ''}</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            ${req.footman ? `
                                <div class="user-cell">
                                    <div class="avatar">${getInitials(req.footman.full_name)}</div>
                                    <div class="user-info">
                                        <div class="user-name">${req.footman.full_name}</div>
                                        <div class="user-email">${req.footman.phone}</div>
                                    </div>
                                </div>
                            ` : '-'}
                        </td>
                        <td>${statusBadges[req.request_status] || '<span class="status-badge">‚ùì Unknown</span>'}</td>
                        <td><strong>${formatCurrency(req.base_price)}</strong></td>
                        <td>${formatCurrency(req.commission)}</td>
                        <td>${methodBadges[req.customer_selected_payment] || '<span class="status-badge">‚ùì Unknown</span>'}</td>
                        <td>${formatDateTime(req.created_at)}</td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="viewRequestDetails(${req.id})">
                                üëÅÔ∏è View
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        async function loadEarnings() {
            try {
                // Get real requests data
                const requests = await apiRequest('/admin/requests?limit=200');
                if (!requests?.success) {
                    showToast('Failed to load earnings data', 'error');
                    return;
                }

                const allRequests = requests.data.requests;
                const totals = requests.data.totals;
                
                // Use totals from API
                const totalRevenue = totals?.total_revenue || 0;
                const totalCommission = totals?.total_commission || 0;
                const partnerEarnings = totals?.partner_earnings || (totalRevenue - totalCommission);
                const totalRequests = totals?.total_requests || 0;
                const avgPerRequest = totalRequests > 0 ? totalRevenue / totalRequests : 0;
                const avgCommission = totalRequests > 0 ? totalCommission / totalRequests : 0;
                
                // Update earnings stats
                document.getElementById('earningsRevenue').textContent = formatCurrency(totalRevenue);
                document.getElementById('totalCommission').textContent = formatCurrency(totalCommission);
                document.getElementById('partnerEarnings').textContent = formatCurrency(partnerEarnings);
                document.getElementById('avgPerRequest').textContent = formatCurrency(avgPerRequest);
                
                // Calculate payment method breakdown from REAL data
                const paymentMethods = {};
                allRequests.forEach(req => {
                    if (req.request_status === 'completed' && req.customer_selected_payment) {
                        const method = req.customer_selected_payment;
                        if (!paymentMethods[method]) {
                            paymentMethods[method] = { count: 0, amount: 0, commission: 0 };
                        }
                        paymentMethods[method].count++;
                        paymentMethods[method].amount += parseFloat(req.base_price || 0);
                        paymentMethods[method].commission += parseFloat(req.commission || 0);
                    }
                });
                
                // Render payment methods table
                const paymentsTable = document.getElementById('paymentsTable');
                const paymentMethodsArray = Object.entries(paymentMethods);
                
                if (paymentMethodsArray.length === 0) {
                    paymentsTable.innerHTML = `
                        <tr>
                            <td colspan="5" class="empty-state">
                                <div class="empty-icon">üí∞</div>
                                <div class="empty-title">No payment data</div>
                                <div class="empty-description">No completed payments yet.</div>
                            </td>
                        </tr>
                    `;
                } else {
                    paymentsTable.innerHTML = paymentMethodsArray.map(([method, data]) => `
                        <tr>
                            <td><strong>${method.charAt(0).toUpperCase() + method.slice(1)}</strong></td>
                            <td>${data.count}</td>
                            <td><strong>${formatCurrency(data.amount)}</strong></td>
                            <td>${formatCurrency(data.commission)}</td>
                            <td>${totalRevenue > 0 ? ((data.amount / totalRevenue) * 100).toFixed(1) : 0}%</td>
                        </tr>
                    `).join('');
                }
                
                // Render recent transactions
                const transactionsTable = document.getElementById('transactionsTable');
                const recentRequests = allRequests
                    .filter(req => req.request_status === 'completed')
                    .slice(0, 10);
                
                if (recentRequests.length === 0) {
                    transactionsTable.innerHTML = `
                        <tr>
                            <td colspan="8" class="empty-state">
                                <div class="empty-icon">üì≠</div>
                                <div class="empty-title">No transactions</div>
                                <div class="empty-description">No completed transactions yet.</div>
                            </td>
                        </tr>
                    `;
                } else {
                    transactionsTable.innerHTML = recentRequests.map(req => {
                        const methodBadges = {
                            cash: '<span class="status-badge">üí∞ Cash</span>',
                            bkash: '<span class="status-badge" style="background:#E2136E;color:white;">bKash</span>',
                            nagad: '<span class="status-badge" style="background:#E30A17;color:white;">Nagad</span>'
                        };
                        
                        return `
                            <tr>
                                <td>${formatDate(req.completed_at || req.created_at)}</td>
                                <td>${req.request_number}</td>
                                <td>${req.customer?.full_name || 'Customer'}</td>
                                <td>${req.footman?.full_name || '-'}</td>
                                <td><strong>${formatCurrency(req.base_price)}</strong></td>
                                <td>${formatCurrency(req.commission)}</td>
                                <td>${methodBadges[req.customer_selected_payment] || '<span class="status-badge">‚ùì Unknown</span>'}</td>
                                <td><span class="status-badge status-completed">‚úÖ Completed</span></td>
                            </tr>
                        `;
                    }).join('');
                }
                
            } catch (error) {
                console.error('Earnings load error:', error);
                showToast('Failed to load earnings data', 'error');
            }
        }

        async function loadOnlinePartners() {
            try {
                const users = await apiRequest('/admin/users?limit=100');
                if (users?.success) {
                    const partners = users.data.users.filter(u => 
                        u.user_type === 'delivery' && u.is_online === true
                    );
                    renderOnlinePartnersTable(partners);
                }
            } catch (error) {
                console.error('Online partners load error:', error);
            }
        }

        function renderOnlinePartnersTable(partners) {
            const tbody = document.getElementById('onlineTable');
            
            if (!partners || partners.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <div class="empty-icon">üìç</div>
                            <div class="empty-title">No partners online</div>
                            <div class="empty-description">No delivery partners are currently online.</div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = partners.map(partner => {
                const rating = partner.rating || 'N/A';
                
                return `
                    <tr>
                        <td>
                            <div class="user-cell">
                                <div class="avatar">
                                    ${partner.profile_image_url && partner.profile_image_url !== 'null' ? 
                                        `<img src="${partner.profile_image_url}" alt="${partner.full_name}">` : 
                                        getInitials(partner.full_name)}
                                </div>
                                <div class="user-info">
                                    <div class="user-name">${partner.full_name || 'N/A'}</div>
                                    <div class="user-email">${partner.phone || 'N/A'}</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <span class="status-badge status-online">üü¢ Online</span>
                        </td>
                        <td>
                            <span class="status-badge status-active">‚úÖ Available</span>
                        </td>
                        <td>
                            <span class="text-muted">üìç GPS tracking needed</span>
                        </td>
                        <td>
                            <div class="d-flex align-center gap-2">
                                <span>${rating}/5</span>
                            </div>
                        </td>
                        <td>${formatTimeAgo(partner.last_location_update || partner.updated_at)}</td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="viewPartnerDetails(${partner.id})">
                                üëÅÔ∏è View
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        async function loadPendingApprovals() {
            try {
                const users = await apiRequest('/admin/users?limit=100');
                if (users?.success) {
                    const pending = users.data.users.filter(u => 
                        u.user_type === 'delivery' && u.is_active === false
                    );
                    renderPendingApprovalsTable(pending);
                }
            } catch (error) {
                console.error('Pending approvals load error:', error);
            }
        }

        function renderPendingApprovalsTable(pending) {
            const tbody = document.getElementById('pendingTable');
            
            if (!pending || pending.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <div class="empty-icon">‚úÖ</div>
                            <div class="empty-title">All caught up!</div>
                            <div class="empty-description">No pending approvals at the moment.</div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = pending.map(partner => {
                const hasProfile = partner.profile_image_url && partner.profile_image_url !== 'null';
                const hasNidFront = partner.nid_front_image_url && partner.nid_front_image_url !== 'null';
                const hasNidBack = partner.nid_back_image_url && partner.nid_back_image_url !== 'null';
                const nidVerified = hasNidFront && hasNidBack && partner.nid_number;
                
                return `
                    <tr>
                        <td>
                            <div class="user-cell">
                                <div class="avatar">${getInitials(partner.full_name)}</div>
                                <div class="user-info">
                                    <div class="user-name">${partner.full_name || 'N/A'}</div>
                                    <div class="user-email">Applied: ${formatDate(partner.created_at)}</div>
                                </div>
                            </div>
                        </td>
                        <td>${formatDate(partner.created_at)}</td>
                        <td>
                            <div class="d-flex gap-2">
                                ${hasProfile ? 
                                    '<span class="status-badge status-active">‚úÖ Photo</span>' : 
                                    '<span class="status-badge status-pending">‚ùå Photo</span>'}
                                ${hasNidFront ? 
                                    '<span class="status-badge status-active">‚úÖ NID F</span>' : 
                                    '<span class="status-badge status-pending">‚ùå NID F</span>'}
                                ${hasNidBack ? 
                                    '<span class="status-badge status-active">‚úÖ NID B</span>' : 
                                    '<span class="status-badge status-pending">‚ùå NID B</span>'}
                            </div>
                        </td>
                        <td>
                            ${nidVerified ? 
                                '<span class="status-badge status-active">‚úÖ Verified</span>' : 
                                '<span class="status-badge status-pending">‚ùå Not Verified</span>'}
                        </td>
                        <td>
                            <div>${partner.phone || 'N/A'}</div>
                            <small class="text-muted">${partner.emergency_contact_phone || 'No emergency'}</small>
                        </td>
                        <td>
                            <div>${partner.emergency_contact_name || 'N/A'}</div>
                            <small class="text-muted">${partner.emergency_contact_relationship || 'N/A'}</small>
                        </td>
                        <td>
                            <div class="d-flex gap-2">
                                <button class="btn btn-success btn-sm" onclick="approvePartner(${partner.id})">
                                    ‚úì Approve
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="rejectPartner(${partner.id})">
                                    ‚úó Reject
                                </button>
                                <button class="btn btn-info btn-sm" onclick="viewPartnerDocuments(${partner.id})">
                                    üìÑ Review
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        async function loadDocumentVerification() {
            try {
                const users = await apiRequest('/admin/users?limit=100');
                if (users?.success) {
                    const partners = users.data.users.filter(u => u.user_type === 'delivery');
                    renderDocumentGallery(partners);
                }
            } catch (error) {
                console.error('Document verification load error:', error);
            }
        }

        function renderDocumentGallery(partners) {
            const gallery = document.getElementById('documentGallery');
            const docs = [];
            
            partners.forEach(partner => {
                if (partner.profile_image_url && partner.profile_image_url !== 'null') {
                    docs.push({
                        type: 'profile',
                        title: 'Profile Photo',
                        partner: partner.full_name,
                        url: partner.profile_image_url,
                        verified: partner.is_active === true
                    });
                }
                
                if (partner.nid_front_image_url && partner.nid_front_image_url !== 'null') {
                    docs.push({
                        type: 'nid_front',
                        title: 'NID Front',
                        partner: partner.full_name,
                        url: partner.nid_front_image_url,
                        verified: partner.is_active === true
                    });
                }
                
                if (partner.nid_back_image_url && partner.nid_back_image_url !== 'null') {
                    docs.push({
                        type: 'nid_back',
                        title: 'NID Back',
                        partner: partner.full_name,
                        url: partner.nid_back_image_url,
                        verified: partner.is_active === true
                    });
                }
            });
            
            if (docs.length === 0) {
                gallery.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-icon">üìÑ</div>
                        <div class="empty-title">No documents</div>
                        <div class="empty-description">No documents have been uploaded yet.</div>
                    </div>
                `;
                return;
            }
            
            gallery.innerHTML = docs.map(doc => `
                <div class="document-item">
                    <img src="${doc.url}" alt="${doc.title}" class="document-image" 
                         onclick="viewDocument('${doc.url}', '${doc.partner} - ${doc.title}')">
                    <div class="document-info">
                        <div class="document-title">${doc.partner}</div>
                        <div class="document-meta">
                            ${doc.title} ‚Ä¢ 
                            ${doc.verified ? 
                                '<span class="text-success">‚úÖ Verified</span>' : 
                                '<span class="text-warning">‚è≥ Pending</span>'}
                        </div>
                        <div class="d-flex gap-2 mt-2">
                            <button class="btn btn-outline btn-sm" onclick="viewDocument('${doc.url}', '${doc.partner} - ${doc.title}')">
                                üëÅÔ∏è View
                            </button>
                            ${!doc.verified ? 
                                `<button class="btn btn-success btn-sm" onclick="verifyDocument('${doc.url}')">
                                    ‚úì Verify
                                </button>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ========== USER ACTIONS ==========
        async function viewUserDetails(userId) {
            try {
                const users = await apiRequest('/admin/users?limit=100');
                if (!users?.success) return;
                
                const user = users.data.users.find(u => u.id === userId);
                if (!user) {
                    showToast('User not found', 'error');
                    return;
                }
                
                document.getElementById('modalTitle').textContent = `${user.full_name || 'User'} Details`;
                
                const modalBody = document.getElementById('modalBody');
                const modalFooter = document.getElementById('modalFooter');
                
                const userType = user.user_type || 'customer';
                const isActive = user.is_active !== false;
                const isOnline = user.is_online === true;
                
                modalBody.innerHTML = `
                    <div class="details-grid">
                        <div class="detail-item">
                            <span class="detail-label">Full Name</span>
                            <div class="detail-value">${user.full_name || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Phone Number</span>
                            <div class="detail-value">${user.phone || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Email Address</span>
                            <div class="detail-value">${user.email || 'No email'}</div>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">User Type</span>
                            <div class="detail-value">
                                ${userType === 'admin' ? 'üëë Admin' : 
                                  userType === 'delivery' ? 'üöö Delivery Partner' : 
                                  'üë§ Customer'}
                            </div>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Account Status</span>
                            <div class="detail-value">
                                ${isActive ? 
                                    '<span class="status-badge status-active">‚úÖ Active</span>' : 
                                    '<span class="status-badge status-pending">‚è≥ Inactive</span>'}
                            </div>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Online Status</span>
                            <div class="detail-value">
                                ${isOnline ? 
                                    '<span class="status-badge status-online">üü¢ Online</span>' : 
                                    '<span class="status-badge status-offline">‚ö´ Offline</span>'}
                            </div>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Registration Date</span>
                            <div class="detail-value">${formatDate(user.created_at)}</div>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Last Updated</span>
                            <div class="detail-value">${formatTimeAgo(user.updated_at)}</div>
                        </div>
                    </div>
                    
                    ${userType === 'delivery' ? `
                        <div class="mt-3">
                            <h3 style="margin-bottom: 16px;">Partner Details</h3>
                            <div class="details-grid">
                                <div class="detail-item">
                                    <span class="detail-label">NID Number</span>
                                    <div class="detail-value">${user.nid_number || 'N/A'}</div>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Emergency Contact</span>
                                    <div class="detail-value">
                                        ${user.emergency_contact_name || 'N/A'} 
                                        (${user.emergency_contact_relationship || 'N/A'})<br>
                                        <small>${user.emergency_contact_phone || 'No phone'}</small>
                                    </div>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Address</span>
                                    <div class="detail-value">${user.address || 'N/A'}</div>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                `;
                
                modalFooter.innerHTML = `
                    ${userType === 'delivery' && !isActive ? 
                        `<button class="btn btn-success" onclick="approveUser(${user.id}, true)">
                            ‚úì Approve Partner
                        </button>` : ''}
                    ${isActive ? 
                        `<button class="btn btn-warning" onclick="deactivateUser(${user.id}, true)">
                            ‚úó Deactivate
                        </button>` : ''}
                    <button class="btn btn-secondary" onclick="document.getElementById('userModal').classList.remove('show')">
                        Close
                    </button>
                `;
                
                document.getElementById('userModal').classList.add('show');
                
            } catch (error) {
                console.error('Error viewing user:', error);
                showToast('Failed to load user details', 'error');
            }
        }

        async function viewPartnerDetails(userId) {
            await viewUserDetails(userId);
        }

        async function viewPartnerDocuments(userId) {
            try {
                const users = await apiRequest('/admin/users?limit=100');
                if (!users?.success) return;
                
                const partner = users.data.users.find(u => u.id === userId && u.user_type === 'delivery');
                if (!partner) {
                    showToast('Partner not found', 'error');
                    return;
                }
                
                document.getElementById('documentsTitle').textContent = `${partner.full_name || 'Partner'} Documents`;
                
                const hasProfile = partner.profile_image_url && partner.profile_image_url !== 'null';
                const hasNidFront = partner.nid_front_image_url && partner.nid_front_image_url !== 'null';
                const hasNidBack = partner.nid_back_image_url && partner.nid_back_image_url !== 'null';
                
                const documentsBody = document.getElementById('documentsBody');
                const documentsFooter = document.getElementById('documentsFooter');
                
                documentsBody.innerHTML = `
                    <div class="details-grid">
                        <div class="detail-item">
                            <span class="detail-label">Partner Name</span>
                            <div class="detail-value">${partner.full_name || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Phone Number</span>
                            <div class="detail-value">${partner.phone || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">NID Number</span>
                            <div class="detail-value">${partner.nid_number || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Verification Status</span>
                            <div class="detail-value">
                                ${partner.is_active ? 
                                    '<span class="status-badge status-active">‚úÖ Approved</span>' : 
                                    '<span class="status-badge status-pending">‚è≥ Pending</span>'}
                            </div>
                        </div>
                    </div>
                    
                    <div class="document-gallery mt-3">
                        ${hasProfile ? `
                            <div class="document-item">
                                <img src="${partner.profile_image_url}" alt="Profile Photo" class="document-image"
                                     onclick="viewDocument('${partner.profile_image_url}', '${partner.full_name} - Profile Photo')">
                                <div class="document-info">
                                    <div class="document-title">Profile Photo</div>
                                    <div class="document-meta">Required for verification</div>
                                    <div class="d-flex gap-2 mt-2">
                                        <a href="${partner.profile_image_url}" target="_blank" class="btn btn-outline btn-sm">
                                            üîó Open Full
                                        </a>
                                    </div>
                                </div>
                            </div>
                        ` : '<div class="empty-state">‚ùå No profile photo uploaded</div>'}
                        
                        ${hasNidFront ? `
                            <div class="document-item">
                                <img src="${partner.nid_front_image_url}" alt="NID Front" class="document-image"
                                     onclick="viewDocument('${partner.nid_front_image_url}', '${partner.full_name} - NID Front')">
                                <div class="document-info">
                                    <div class="document-title">NID Front</div>
                                    <div class="document-meta">National ID Card (Front)</div>
                                    <div class="d-flex gap-2 mt-2">
                                        <a href="${partner.nid_front_image_url}" target="_blank" class="btn btn-outline btn-sm">
                                            üîó Open Full
                                        </a>
                                    </div>
                                </div>
                            </div>
                        ` : '<div class="empty-state">‚ùå No NID front uploaded</div>'}
                        
                        ${hasNidBack ? `
                            <div class="document-item">
                                <img src="${partner.nid_back_image_url}" alt="NID Back" class="document-image"
                                     onclick="viewDocument('${partner.nid_back_image_url}', '${partner.full_name} - NID Back')">
                                <div class="document-info">
                                    <div class="document-title">NID Back</div>
                                    <div class="document-meta">National ID Card (Back)</div>
                                    <div class="d-flex gap-2 mt-2">
                                        <a href="${partner.nid_back_image_url}" target="_blank" class="btn btn-outline btn-sm">
                                            üîó Open Full
                                        </a>
                                    </div>
                                </div>
                            </div>
                        ` : '<div class="empty-state">‚ùå No NID back uploaded</div>'}
                    </div>
                `;
                
                documentsFooter.innerHTML = `
                    ${!partner.is_active ? `
                        <button class="btn btn-success" onclick="approvePartner(${partner.id}, true)">
                            ‚úì Approve Partner
                        </button>
                        <button class="btn btn-danger" onclick="rejectPartner(${partner.id}, true)">
                            ‚úó Reject
                        </button>
                    ` : ''}
                    <button class="btn btn-secondary" onclick="document.getElementById('documentsModal').classList.remove('show')">
                        Close
                    </button>
                `;
                
                document.getElementById('documentsModal').classList.add('show');
                
            } catch (error) {
                console.error('Error viewing partner documents:', error);
                showToast('Failed to load documents', 'error');
            }
        }

        function viewDocument(url, title) {
            window.open(url, '_blank');
        }

        async function viewRequestDetails(requestId) {
            try {
                const requests = await apiRequest('/admin/requests?limit=200');
                if (!requests?.success) return;
                
                const request = requests.data.requests.find(r => r.id === requestId);
                if (!request) {
                    showToast('Request not found', 'error');
                    return;
                }
                
                document.getElementById('requestTitle').textContent = `Request ${request.request_number}`;
                
                const requestBody = document.getElementById('requestBody');
                requestBody.innerHTML = `
                    <div class="details-grid">
                        <div class="detail-item">
                            <span class="detail-label">Request Number</span>
                            <div class="detail-value">${request.request_number}</div>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Status</span>
                            <div class="detail-value">
                                ${request.request_status === 'completed' ? 
                                    '<span class="status-badge status-completed">‚úÖ Completed</span>' :
                                    request.request_status === 'cancelled' ?
                                    '<span class="status-badge status-inactive">‚ùå Cancelled</span>' :
                                    '<span class="status-badge status-pending">‚è≥ Pending</span>'}
                            </div>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Customer</span>
                            <div class="detail-value">
                                ${request.customer?.full_name || 'Unknown'}<br>
                                <small>${request.customer?.phone || ''}</small>
                            </div>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Delivery Partner</span>
                            <div class="detail-value">
                                ${request.footman?.full_name || 'Not assigned'}<br>
                                <small>${request.footman?.phone || ''}</small>
                            </div>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Total Amount</span>
                            <div class="detail-value">${formatCurrency(request.base_price)}</div>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Your Commission (10%)</span>
                            <div class="detail-value">${formatCurrency(request.commission)}</div>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Partner Earnings (90%)</span>
                            <div class="detail-value">${formatCurrency(request.footman_earnings)}</div>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Payment Method</span>
                            <div class="detail-value">
                                ${request.customer_selected_payment ? 
                                    `<span class="status-badge">${request.customer_selected_payment.charAt(0).toUpperCase() + request.customer_selected_payment.slice(1)}</span>` : 
                                    'Not selected'}
                            </div>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Created</span>
                            <div class="detail-value">${formatDateTime(request.created_at)}</div>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Completed</span>
                            <div class="detail-value">${request.completed_at ? formatDateTime(request.completed_at) : 'Not completed'}</div>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <h3 style="margin-bottom: 16px;">Location Details</h3>
                        <div class="details-grid">
                            <div class="detail-item">
                                <span class="detail-label">Pickup Location</span>
                                <div class="detail-value">
                                    Latitude: ${request.pickup_lat}<br>
                                    Longitude: ${request.pickup_lng}
                                </div>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Distance</span>
                                <div class="detail-value">${request.distance_km} KM</div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('requestFooter').innerHTML = `
                    <button class="btn btn-secondary" onclick="document.getElementById('requestModal').classList.remove('show')">
                        Close
                    </button>
                `;
                
                document.getElementById('requestModal').classList.add('show');
                
            } catch (error) {
                console.error('Error viewing request:', error);
                showToast('Failed to load request details', 'error');
            }
        }

        async function approveUser(userId, fromModal = false) {
            if (!confirm('Are you sure you want to approve this user?')) return;
            
            try {
                const result = await apiRequest(`/admin/users/${userId}/status`, {
                    method: 'PUT',
                    body: JSON.stringify({ is_active: true })
                });
                
                if (result?.success) {
                    showToast('User approved successfully!', 'success');
                    if (fromModal) {
                        document.getElementById('userModal').classList.remove('show');
                        document.getElementById('documentsModal').classList.remove('show');
                    }
                    loadPageData(State.currentPage);
                }
            } catch (error) {
                showToast(`Failed to approve user: ${error.message}`, 'error');
            }
        }

        async function approvePartner(userId, fromModal = false) {
            await approveUser(userId, fromModal);
        }

        async function deactivateUser(userId, fromModal = false) {
            if (!confirm('Are you sure you want to deactivate this user?')) return;
            
            try {
                const result = await apiRequest(`/admin/users/${userId}/status`, {
                    method: 'PUT',
                    body: JSON.stringify({ is_active: false })
                });
                
                if (result?.success) {
                    showToast('User deactivated successfully!', 'success');
                    if (fromModal) {
                        document.getElementById('userModal').classList.remove('show');
                    }
                    loadPageData(State.currentPage);
                }
            } catch (error) {
                showToast(`Failed to deactivate user: ${error.message}`, 'error');
            }
        }

        async function rejectPartner(userId, fromModal = false) {
            const reason = prompt('Please enter rejection reason:');
            if (!reason) return;
            
            try {
                // Note: You need to implement rejection endpoint
                showToast('Rejection feature requires backend implementation', 'info');
                // For now, just deactivate
                await deactivateUser(userId, fromModal);
            } catch (error) {
                showToast(`Failed to reject partner: ${error.message}`, 'error');
            }
        }

        function verifyDocument(url) {
            showToast('Document verification feature requires backend implementation', 'info');
        }

        // ========== INITIALIZATION ==========
        function initApp() {
            setupNavigation();
            updateAdminInfo();
            loadDashboard();
            
            // Set up auto-refresh for dashboard
            setInterval(() => {
                if (State.currentPage === 'dashboard') {
                    loadDashboard();
                }
            }, Config.REFRESH_INTERVAL);
            
            // Set up event listeners for refresh buttons
            document.getElementById('refreshActivity')?.addEventListener('click', () => loadDashboard());
            document.getElementById('refreshOnline')?.addEventListener('click', () => loadOnlinePartners());
            document.getElementById('refreshPending')?.addEventListener('click', () => loadPendingApprovals());
            document.getElementById('exportEarnings')?.addEventListener('click', () => {
                showToast('Export feature requires backend implementation', 'info');
            });
        }

        function updateAdminInfo() {
            if (State.currentUser) {
                const avatar = getInitials(State.currentUser.full_name || 'Admin');
                document.getElementById('adminAvatar').textContent = avatar;
                document.getElementById('topbarAvatar').textContent = avatar;
                document.getElementById('loginPhone').value = State.currentUser.phone || '01700000000';
            }
        }

        // Start the application
        document.addEventListener('DOMContentLoaded', initAuth);
    </script>
</body>
</html>
<!-- Updated at: $(date) -->
